{
  "hash": "1fc3157ceca8aa92dc7c605595076b21",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Randomise papers\nsubtitle: Describes random selection of papers for inclusion in the review\nauthor: Saoirse Kelleher\ndate: today\nformat: \n  html:\n    code-fold: true\n    theme: minty\n    toc: true\n    embed-resources: true\nbibliography: references.bib\n---\n\n\n## Overview\n\nAs this review evolved, two samples of target papers were acquired from two distinct sampling protocols.\n\n-   The **First Sample** was acquired in October 2021 from Google Scholar. The first 100 hits for each of four search terms ('dynamic occupancy model,' 'occupancy dynamics model,' 'multi-season occupancy model,' and 'stochastic patch occupancy model', plus allowances for pluralisation) were downloaded. These were stratified by their query and year-window (2000-2005, 2006-2010, 2010-2015, and 2016-2021). A random sample of 25% of the strata *or* 5 papers, whichever was larger, was flagged for inclusion in the review, to be replaced from the same strata if inclusion criteria were not met.\n\n-   After reviewing this initial sample, the need for a **Second Sample** was identified as many of the papers included in the first did not represent our model of interest. This second, more narrowly targeted sample was drawn from papers citing @mackenzie2003, the original description of the model class which all subsequent implementations would be expected to cite. Papers were acquired via Web of Science in September 2023. The same 4 year-window strata were used here, with 15 papers randomly drawn from each strata. A fifth strata was added for 2022-2023, to capture the most recent papers on these models.\n\nFor transparency and reproducibility, the randomisation code is preserved in this document.\n\n## First sample\n\nThe full list of papers acquired from the aforementioned queries is read into R, and each is assigned to a year-window.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\nlibrary(\"knitr\")\nlibrary(\"tidyverse\") \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\nlibrary(\"readxl\")\n\nset.seed(5378)\n\n# From the excel review spreadsheet, read in only the identifying characteristics \nfirst_idSheet <- readxl::read_xlsx(\"Spreadsheets/Stage1_Spreadsheet.xlsx\", \n                                     sheet = \"Metadata\", skip = 1) %>%\n  # Drop rows prior to start of data\n  slice(4:nrow(.)) %>%\n  # Only need google search query and the ID reference\n  select(Review_ID, Query = `Search terms`) \n\n# Repeat with the study metadata\nfirst_studyDataSheet <- readxl::read_xlsx(\"Spreadsheets/Stage1_Spreadsheet.xlsx\", \n                                    sheet = \"Study data\", skip = 1) %>%\n  # Cut out non-data rows\n  slice(4:nrow(.)) %>%\n  # Only need year data and ID reference\n  select(Review_ID, Title, Year) \n\n# Merge paper queries and metadata\nfirst_paperList <- full_join(first_idSheet, first_studyDataSheet, \n                             by = \"Review_ID\") %>%\n  # Exclude some non-query papers and add year periods to the rest\n  # Drop empty rows, excluded, and incidental papers\n  filter(!is.na(Query) & Query != \"INCIDENTAL\" & Year != \"EXCLUDE\") %>%\n  # Break into time periods \n  mutate(YearPeriod = case_when(Year %in% as.character(2000:2005) ~ \"2000:2005\",\n                                Year %in% as.character(2006:2010) ~ \"2006:2010\",\n                                Year %in% as.character(2011:2015) ~ \"2011:2015\",\n                                Year %in% as.character(2016:2021) ~ \"2016:2021\"))\n\nhead(first_paperList) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|Review_ID |Query                   |Title                                                                                                                                                      |Year |YearPeriod |\n|:---------|:-----------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------|:----|:----------|\n|6         |Dynamic occupancy model |Single-visit dynamic occupancy models: an approach to account for imperfect detection with Atlas data                                                      |2017 |2016:2021  |\n|7         |Dynamic occupancy model |A dynamic occupancy model for interacting species with two spatial scales                                                                                  |2020 |2016:2021  |\n|8         |Dynamic occupancy model |A multistate dynamic occupancy model to estimate local colonization–extinction rates and patterns of co‐occurrence between two or more interacting species |2019 |2016:2021  |\n|9         |Dynamic occupancy model |Neural hierarchical models of ecological populations                                                                                                       |2019 |2016:2021  |\n|11        |Dynamic occupancy model |Unravelling the drastic range retraction of an emblematic songbird of North Africa: potential threats to Afro-Palearctic migratory birds                   |2017 |2016:2021  |\n|12        |Dynamic occupancy model |Detecting dispersal: A spatial dynamic occupancy model to reliably quantify connectivity across heterogeneous conservation landscapes                      |2021 |2016:2021  |\n\n\n:::\n:::\n\n\nA random number is then assigned to *all* papers. Papers are then ranked by number within their year-window/query strata. Papers in the top 5/25% (whichever was larger) were flagged to be read, and the rest were kept available for replacement of papers which may fail to meet inclusion criteria.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Randomly rank papers, then rank within the strata\nfirst_rankedPapers <- first_paperList %>%\n  # Add random ranks for all papers\n  mutate(randRank = sample(x = 1:nrow(.), size = nrow(.))) %>%\n  # Re-rank within strata\n  group_by(Query, YearPeriod) %>%\n  arrange(Query, YearPeriod, randRank) %>%\n  mutate(GroupRank = row_number()) %>%\n# Identify which papers qualify to be read\n  group_by(Query, YearPeriod) %>%\n  mutate(PercentRank =  GroupRank/max(GroupRank)) %>%\n  mutate(ToRead = case_when(\n    # If there are fewer than 5, read them all\n    max(GroupRank) <= 5 ~ \"YES\",\n    # If there are 20 or fewer, read the top 5\n    max(GroupRank) <= 20 & GroupRank <= 5 ~ \"YES\",\n    max(GroupRank) <= 20 & GroupRank >= 5 ~ \"NO\",\n    # If there are 21 or more, read the top 25%\n    max(GroupRank) >= 21 & PercentRank <= 0.25  ~ \"YES\",\n    max(GroupRank) >= 21 & PercentRank > 0.25 ~ \"NO\")) %>%\n  ungroup() %>%\n  unite(col = Group, c(Query, YearPeriod)) %>%\n  # Get Review_ID, GroupRank, and ToRead\n  select(Review_ID, Title, Group, OverallRank = randRank, GroupRank, ToRead)\n\nhead(first_rankedPapers) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|Review_ID |Title                                                                                                                                               |Group                             | OverallRank| GroupRank|ToRead |\n|:---------|:---------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------|-----------:|---------:|:------|\n|51        |Dealing with uncertainty in amphibian and reptile population monitoring for conservation                                                            |Dynamic occupancy model_2006:2010 |          30|         1|YES    |\n|69        |A BAYESIAN STATE-SPACE FORMULATION OF DYNAMIC OCCUPANCY MODELS                                                                                      |Dynamic occupancy model_2006:2010 |          82|         2|YES    |\n|63        |Occurrence patterns of Black-backed Woodpeckers in green forest of the Sierra Nevada Mountains, California, USA.                                    |Dynamic occupancy model_2011:2015 |          57|         1|YES    |\n|50        |Individual and population-level responses of the Alabama beach mouse (Peromyscus polionotus ammobates) to environmental variation in space and time |Dynamic occupancy model_2011:2015 |          67|         2|YES    |\n|59        |Effects of Urbanization on Occupancy of Stream Salamanders: Salamander Occupancy and Urbanization                                                   |Dynamic occupancy model_2011:2015 |          69|         3|YES    |\n|39        |Coffee Agroforests Remain Beneficial for Neotropical Bird Community Conservation across Seasons                                                     |Dynamic occupancy model_2011:2015 |          70|         4|YES    |\n\n\n:::\n:::\n\n\nIncidental papers which were not ranked are returned to the dataframe, and the output is saved.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nfirst_unrankedPapers <- first_paperList %>% \n  # Drop empty rows, excluded, and incidental papers\n  filter(is.na(Query) | Query == \"INCIDENTAL\" | Year == \"EXCLUDE\") %>%\n  mutate(ToRead = \"NO\", Group = \"Unranked\", GroupRank = \"NA\", OverallRank = \"NA\") %>%\n  select(Review_ID, Title, Group, OverallRank, GroupRank, ToRead)\n\n# Combine ranked and unranked papers\nfirstSample <- rbind(first_rankedPapers, first_unrankedPapers) %>%\n  mutate(Review_ID = as.numeric(Review_ID)) %>%\n  arrange(Review_ID) %>%\n  mutate(Sample = \"First\")\n\n# Write to disk\nwrite_csv(firstSample, file = \"Randomisation/FirstSampleRanks.csv\")\n```\n:::\n\n\n## Second sample\n\nThe list of papers pulled from Web of Science is loaded in - 1184 papers are represented here. Year-windows are assigned here as in the **First Sample.**\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| warning: false\n# Load query and extract relevant columns\nsecond_Query <- readxl::read_xls(\"Queries/MacKenzie WOS/MacKenzie03.xls\") %>%\n  select(Review_ID, Title = `Article Title`, Year = `Publication Year`) %>%\n  # Assign year period\n  mutate(YearPeriod = case_when(Year %in% 2000:2005 ~ \"2000:2005\",\n                                Year %in% 2006:2010 ~ \"2006:2010\",\n                                Year %in% 2011:2015 ~ \"2011:2015\",\n                                Year %in% 2016:2021 ~ \"2016:2021\",\n                                Year %in% 2022:2023 ~ \"2022:2023\"))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Expecting numeric in AZ1151 / R1151C52: got 'S'\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| warning: false\nhead(second_Query) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n| Review_ID|Title                                                                                                                                           | Year|YearPeriod |\n|---------:|:-----------------------------------------------------------------------------------------------------------------------------------------------|----:|:----------|\n|       300|Estimating the effects of land abandonment on mammal communities in the Karoo region of South Africa                                            | 2023|2022:2023  |\n|       301|Occupancy of Bombus affinis (Hymenoptera: Apidae) in Minnesota is highest in developed areas when standardized surveys are employed             | 2023|2022:2023  |\n|       302|Climate casualties or human disturbance? Shrinking distribution of the three large carnivores in the Greater Himalaya                           | 2023|2022:2023  |\n|       303|Nonparametric Identifiability in Species Distribution and Abundance Models: Why it Matters and How to Diagnose a Lack of it Using Simulation    | 2023|2022:2023  |\n|       304|Variation in flight characteristics associated with entry by eagles into rotor-swept zones of wind turbines                                     | 2023|2022:2023  |\n|       305|Passive acoustic monitoring using smartphones reveals an alarming gibbon decline in a protected area in the central Annamite Mountains, Vietnam | 2023|2022:2023  |\n\n\n:::\n:::\n\n\nPapers are assigned a random number and ranked within their groups, and top-15 papers are flagged to be read. The output is saved for future reference.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nsecondSample <- second_Query %>%\n  # Add query flag to match with the first sample\n  mutate(Query = \"MacKenzie Cited\") %>%\n  # Add random ranks for all papers\n  mutate(randRank = sample(x = 1:nrow(.), size = nrow(.))) %>%\n  # Re-rank within strata\n  group_by(Query, YearPeriod) %>%\n  arrange(Query, YearPeriod, randRank) %>%\n  mutate(GroupRank = row_number()) %>% \n  mutate(ToRead = case_when(\n    GroupRank <= 15 ~ \"YES\",\n    GroupRank >15 ~ \"NO\")) %>%\n  unite(col = Group, c(Query, YearPeriod)) %>%\n  mutate(Sample = \"Second\") %>%\n  # Get Review_ID, GroupRank, and ToRead\n  select(Sample, Review_ID, Title, Group, OverallRank = randRank, GroupRank, ToRead)\n  \nwrite_csv(secondSample, \"Randomisation/SecondSampleRanks.csv\")\n\nhead(secondSample) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|Sample | Review_ID|Title                                                                                                                                        |Group                     | OverallRank| GroupRank|ToRead |\n|:------|---------:|:--------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------|-----------:|---------:|:------|\n|Second |      1479|Using counts to simultaneously estimate abundance and detection probabilities in a salamander community                                      |MacKenzie Cited_2000:2005 |          18|         1|YES    |\n|Second |      1481|Declining amphibian populations: The pitfalls of count data in the study of diversity, distributions, dynamics, and demography               |MacKenzie Cited_2000:2005 |          37|         2|YES    |\n|Second |      1461|Influence of the temporal resolution of data on the success of indicator species models of species richness across multiple taxonomic groups |MacKenzie Cited_2000:2005 |          78|         3|YES    |\n|Second |      1455|Modeling spatial trends in estimated species richness using breeding bird survey data: A valuable tool in biodiversity assessment            |MacKenzie Cited_2000:2005 |         204|         4|YES    |\n|Second |      1467|A field-based evaluation of a presence-absence protocol for monitoring ecoregional-scale biodiversity                                        |MacKenzie Cited_2000:2005 |         284|         5|YES    |\n|Second |      1469|Monitoring distributions using call surveys: estimating site occupancy, detection probabilities and inferring absence                        |MacKenzie Cited_2000:2005 |         366|         6|YES    |\n\n\n:::\n:::\n\n\n## Sample summary\n\nA basic representation of the two sample's coverage is presented here. The data presented is from after randomisation, **not** after reviewing, and thus does not represent the final coverage of the review as some papers may be excluded.\n\n### First sample categories\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nfirstSample %>%\n  separate(Group, c(\"Query\", \"YearWindow\"), sep = \"_\") %>%\n  \n  ggplot() +\n  geom_bar(aes(x = YearWindow, fill = ToRead)) +\n  scale_fill_manual(values = c(\"gray70\", \"dodgerblue2\")) +\n  facet_wrap(vars(Query), nrow = 2) +\n  labs(title = \"Coverage of the Primary Sample\",\n       y = \"Number of Papers\",\n       x = \"Year Window\",\n       fill = \"Included\")\n```\n\n::: {.cell-output-display}\n![](Randomise_Papers_files/figure-html/plot first sample categories-1.png){width=672}\n:::\n:::\n\n\n### Second sample categories\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nsecondSample %>%\n  separate(Group, c(\"Query\", \"YearWindow\"), sep = \"_\") %>%\n  \n  ggplot() +\n  geom_bar(aes(x = YearWindow, fill = ToRead)) +\n  scale_fill_manual(values = c(\"gray70\", \"firebrick3\")) +\n  labs(title = \"Coverage of the Secondary Sample\",\n       y = \"Number of Papers\",\n       x = \"Year Window\",\n       fill = \"Included\")\n```\n\n::: {.cell-output-display}\n![](Randomise_Papers_files/figure-html/plot second sample categories-1.png){width=672}\n:::\n:::\n\n\n### Combined sample\n\nAdding the second sample improves coverage across the review period, particularly in the first two year-windows where fewer papers were included in the first sample.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nrbind(firstSample, secondSample) %>%\n  separate(Group, c(\"Query\", \"YearWindow\"), sep = \"_\") %>%\n  filter(ToRead == \"YES\") %>%\n  \n  ggplot() +\n  geom_bar(aes(x = YearWindow, fill = Sample)) +\n  scale_fill_manual(values = c(\"dodgerblue2\", \"firebrick3\")) +\n  labs(title = \"Coverage of combined sample\",\n       y = \"Number of papers\",\n       x = \"Year-window\")\n```\n\n::: {.cell-output-display}\n![](Randomise_Papers_files/figure-html/combined sample-1.png){width=672}\n:::\n:::\n\n\n## References\n",
    "supporting": [
      "Randomise_Papers_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}