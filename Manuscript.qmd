---
title: "Twenty years of dynamic occupancy models: a review of applications and look towards the future"
date: today

authors:
  - name: Saoirse Kelleher
    affiliation: University of Melbourne
    email: saoirse.kelleher@student.unimelb.edu.au
    orcid: 0000-0002-4614-5753
    corresponding: true
  - name: Natalie Briscoe
    affiliation: University of Melbourne
  - name: Gurutzeta Guillera-Arroita
    affiliation: Pyrenean Institute of Ecology, Spanish National Research Council
  - name: Jane Elith
    affiliation: University of Melbourne
    
abstract: | 
 Occupancy models.

format:
  html:
    theme: simplex

embed-resources: true
title-block-banner: true
---

# Introduction

Background Information section

#### Model form and assumptions

Model form.

![The form of the dynamic occupancy model as described by @mackenzie2003. The ecological process sub-model describes changes in occupancy over time, while the observational process sub-model describes detectability.](Figures/ModelForm.png){#fig-modelform}

Survey design.

![The sampling design of the standard dynamic occupancy model. During seasons (also called primary occasions) sites are considered closed to changes in true occupancy state; occupancy state may only change between seasons. Within each season, multiple observations (also called surveys or secondary occasions) are conducted to record the observed presence or absence of the species at each site. These multiple observations may be recorded in many ways: sites can be revisited multiple times within a season, surveys can be conducted at multiple points within a larger site, multiple observers can conduct surveys contemporaneously, or the time elapsed prior to a detection occurring can be recorded. Note that it is not necessary for each site or season to have the same number of observations, and that missing data can be accommodated.](Figures/SurveyDesign.png){#fig-surveys fig-align="center"}

Assumptions.

# Review methods

Methods.

# Results

Coverage.

![Bars indicate the 92 articles included in our review as a proportion of the estimated number of published articles fitting DOMs, based on the qualification rate for articles in each strata. The proportion of articles included from each strata were as follows: 12% from 2005-2008; 24% from 2008-2011; 42% from 2012-2015; 35% from 2016-2019; and 57% from 2020-2023.](Figures/CoveragePlot.jpeg){#fig-coverage}

Stamp collection.

![A) Locations of study areas where data was collected for reviewed DOMs. B) Spatial extent of study areas, defined as the area of inference, within which all surveyed points were contained. C) Number of articles which fit models to each category of taxa. Taxa were considered 'threatened' if they are listed on the IUCN Red List, or if authors indicate that they are otherwise threatened. D) Explicitly multi-species models include both hierarchical, jointly estimated models as well as more interactive models. Some studies fit both independent and multi-species models, such that these values do not sum to our sample size. E) Survey methods used to collected presence/absence data. Note that some articles employed multiple detection methods, and that some methods (e.g., citizen bird counts) may fall into multiple categories. F) Quantity of sites where surveys were conducted and duration of studies. Yellow bars indicate median values for site quantity (100) and study duration (8.2 years). Study duration is defined as the time elapsed between the first and last survey.](Figures/ReviewBox.png){#fig-StudyDetails}

Covariates.

::: column-page-inset
```{r covariate table}
#| echo: false
#| message: false
#| label: tbl-covariates
#| tbl-cap: "All covariates considered for inclusion in a study were classified into mutually exclusive categories. We calculate the percentage of studies which include at least one covariate of a given category on any parameter, Initial Occupancy (&psi;1), Occupancy (&psi;), Colonisation (&gamma;), Extinction(&epsilon;), and Detection (&rho;). We also present the average percentage of covariates in a category which are dynamic (varying through seasons) and directly observed, as well as the percentage of articles which model each category of covariate with a non-linear relationship or as part of an interaction with another covariate."

library(tidyverse)
library(gt)

covTable <- read_csv("Figures/CovariateTable.csv")

covTable |>
  mutate(Summary = case_when(Covariate %in% c("Environmental", "Structural", "Overall") ~ TRUE,
                             .default = FALSE)) |>
  arrange(Category, Summary, -Prop_Any) |>
  gt(rowname_col = "Covariate", groupname_col = "Category") |>
  tab_options(
    row_group.as_column = TRUE
  ) |>
  tab_row_group(
    label = md("Environmental covariates"),
    rows = Category == "E",
    id = "Env"
  ) |>
  tab_row_group(
    label = md("Structural covariates"),
    rows = Category == "S",
    id = "Struct"
  ) |>
  tab_row_group(
    label = md("All covariates"),
    rows = Category == "O",
    id = "All"
  ) |>
  tab_style(
    style = cell_fill(color = "aquamarine4"),
    locations = cells_row_groups(groups = "Env")
  ) |>
  tab_style(
    style = list(
      cell_fill(color = "plum4")
    ),
    locations = cells_row_groups(groups = "Struct")
  ) |>
  tab_style(
    style = list(
      cell_fill(color = "gray60")
    ),
    locations = cells_row_groups(groups = "All")
  ) |>
  row_group_order(groups = c("Env", "Struct", "All")) |>
  tab_spanner(label = "Percentage of articles with covariate on parameters:",
              columns = c("Prop_Any", "Initial occupancy", "Occupancy",
                          "Colonisation", "Extinction_Persistence",
                          "Detection"),
              id = "inclusions") |>
  tab_spanner(label = "Percentage which are:",
              columns = c(Prop_Dynamic, Prop_Direct),
              id = "covariates") |>
  tab_spanner(label = "Articles representing this covariate with:",
              columns = c(Prop_Nonlinear, Prop_Interact),
              id = "representations") |>
   cols_label(
    Prop_Any = "Any",
    `Initial occupancy` = html("&psi;1"),
    Occupancy = html("&psi;"),
    Colonisation = html("&gamma;"),
    Extinction_Persistence = html("&epsilon;"),
    Detection = html("&rho;"),
    Prop_Dynamic = "Dynamic",
    Prop_Direct = "Directly observed",
    Prop_Nonlinear = "Non-linear relationships",
    Prop_Interact = "Interactions between covariates"
  ) |>
  text_case_match(
    "Environmental" ~ html("<b>Any Environmental</b>"),
    "HABT" ~ html("<b>Habitat </b>\n<i>Aspects of habitat and land cover</i>"),
    "PHEN" ~ html("<b>Phenology</b>\n<i>Time-varying elements distinct from sampling occasions</i>"),
    "SPAT" ~ html("<b>Spatial</b>\n<i>Site geometry, connectivity, or other spatial elements</i>"),
    "OTHER-E" ~ html("<b>Other environmental</b>\n<i>Other environmental covariate not otherwise listed</i>"),
    "TOPO" ~ html("<b>Topography</b>\n<i>Elements of landscape topography</i>"),
    "HYDR" ~ html("<b>Hydrology</b>\n<i>Aspects of hydrology, such as distance to water</i>"),
    "CLWE" ~ html("<b>Climate/Weather</b>\n<i>Climate, weather, and natural disasters</i>"),
    "ANTH" ~ html("<b>Anthropogenic</b>\n<i>Relations to human activity</i>"),
    "BIOT" ~ html("<b>Biotic interaction</b>\n<i>Interactions with other (non-plant) species</i>"),
    "Structural" ~ html("<b>Any Structural</b>"),
    "SEAS" ~ html("<b>Primary occasion</b>\n<i>Effect of the primary occasion</i>"),
    "OBSE" ~ html("<b>Observation</b>\n<i>Details on the observation process</i>"),
    "SURV" ~ html("<b>Secondary occasion</b>\n<i>Effect of the secondary occasion</i>"),
    "SPEC" ~ html("<b>Species effect</b>\n<i>Species-level effects</i>"),
    "SITE" ~ html("<b>Site effect</b>\n<i>Site-level effects</i>"),
    "OTHER-S" ~ html("<b>Other structural</b>\n<i>Other structural covariate not otherwise listed</i>"),
    "Overall" ~ html("<b>All covariates</b>"),
    .locations = cells_stub()
  ) |>
  cols_hide(c(Category, Summary)) |>
  fmt_percent(decimals = 0) |>
  sub_missing(missing_text = "-") |>
  data_color(
    columns = where(is.numeric),
    method = "numeric",
    palette = "viridis",
    alpha = 0.5
  ) |>
  tab_style(locations = cells_stub(rows = "Environmental"),
            style = cell_fill(color = "aquamarine4", alpha = 0.5)) |>
  tab_style(locations = cells_body(rows = "Environmental"),
            style = list(cell_fill(color = "aquamarine4", alpha = 0.5),
                         cell_text(weight = "bold", style = "italic",
                                   color = "black"))) |>
  tab_style(locations = cells_stub(rows = "Structural"),
            style = cell_fill(color = "plum4", alpha = 0.5)) |>
  tab_style(locations = cells_body(rows = "Structural"),
            style = list(cell_fill(color = "plum4", alpha = 0.5),
                         cell_text(weight = "bold", style = "italic",
                                   color = "black"))) |>
  tab_style(locations = cells_stub(rows = "Overall"),
            style = cell_fill(color = "gray60", alpha = 0.5)) |>
  tab_style(locations = cells_body(rows = "Overall"),
            style = list(cell_fill(color = "gray60", alpha = 0.5),
                         cell_text(weight = "bold",
                                   color = "black"))) |>
  tab_style(locations = cells_row_groups(),
            style = cell_text(color = "white")) |>
  as_raw_html()
```
:::

More covariates.

![The number of covariates considered for each parameter across all studies in our sample. 'Occupancy' given here represents the alternative parameterisation of the DOM which jointly estimates Occupancy for every season, Colonisation, and Detection, where Extinction is a derived parameter; this differs from the more popular Initial occupancy/Colonisation/Extinction/Detection parameterisation. Here, a 'covariate' is defined as each distinct covariate considered for inclusion. Linear and quadratic representations of the same covariate are counted as one covariate.](Figures/CovParamPlot.jpeg){#fig-covariates}

Modelling summary.

```{r Modelling summary table}
#| echo: false
#| message: false
#| label: tbl-modelling
#| tbl-cap: "Modelling practices in dynamic occupancy models, subset by frequentist or bayesian implementations. The median covariate count presented here represents the median quantity of covariates considered for each model parameter across the studies in our review. The model selection methods represented in this table are non-exclusive and some articles employ multiple approaches. 2 models included in the 'Overall' column are neural network based and fall into neither the Frequentist or Bayesian categories."
 
modellingSummary <- read_csv("Figures/ModellingSummary.csv")

modellingSummary |>
  mutate(Variable = fct(Variable, 
                        levels = c("Number", "MedianCovs", 
                                   "Prop_AnySelect", "Prop_Candidate",
                                   "Prop_Sequential", "Prop_Simple",
                                   "Prop_ModAvg", "Prop_GOF", 
                                   "Prop_Eval"))) |>
  arrange(Variable) |>
  mutate(Variable = as.character(Variable)) |>
  gt(rowname_col = "Variable") |> 
  tab_row_group(
    label = "Covariate selection methods",
    rows = c("Prop_AnySelect", "Prop_Candidate",
             "Prop_Sequential", "Prop_Simple", "Prop_ModAvg"),
    id = "select"
  ) |>
  tab_row_group(
    label = "Model evaluation conducted",
    rows = c("Prop_GOF", "Prop_Eval"),
    id = "eval"
  ) |>
  row_group_order(groups = c(NA, "select", "eval")) |>
  text_case_match("Number" ~ "Number of studies",
                  "MedianCovs" ~ "Median covariates considered per parameter",
                  "Prop_ModAvg" ~ "Percentage using model-averaging",
                  "Prop_AnySelect" ~ "Percentage using any model selection approach",
                  "Prop_Sequential" ~ "Percentage using procedural model selection",
                  "Prop_Simple" ~ "Percentage selecting covariates with simpler models",
                  "Prop_Candidate" ~ "Percentage comparing models in a candidate set",
                  "Prop_GOF" ~ "Percentage calculating goodness-of-fit",
                  "Prop_Eval" ~ "Percentage assessing predictive performance",
                  .locations = cells_stub()) |>
  fmt_percent(rows = 3:9, decimals = 0) |>
  fmt_integer(rows = 1) |>
  tab_stub_indent(
    rows = 3:9,
    indent = 3
  ) |>
  tab_style(
    locations = cells_row_groups(),
    style = cell_text(style = "italic")
  ) |>
  tab_style(
    locations = cells_column_labels(),
    style = list(cell_fill(color = "aquamarine4"),
                 cell_text(color = "white"))
  ) |>
  tab_style(
    locations = cells_body(columns = "All models"),
    style = cell_text(style = "italic")
  ) 
#|>
 # as_raw_html()
```

Objectives.

![A) Proportion of articles in each year-strata and across all years which match each of six non-exclusive objective categories. B) Quantity of covariates considered per parameter for models which pursued each objectives.](Figures/ObjectiveFigure.jpeg){#fig-objectives}

More objectives.

# Discussion

Discussion.

# Conclusions

Conclusions.
