---
title: "DOM Review Summary"
author: "Saoirse Kelleher"
date: "March 13 2024"
date-modifed: today
abstract: "A summary of results from the DOM Review, for use in interpreting outputs and writing the review manuscript. "
abstract-title: "Summary"
format: 
  html:
    theme: minty
    toc: true
embed-resources: true
---

```{r Load_packages}
#| include: false

library(tidyverse)
library(readxl)
library(knitr)
library(reactable)
```

```{r Load_data}
#| include: false

# Study Details
review_StudyDetails <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                                 sheet = "Study") |>
  select(ID = "Review ID", Sample, Status, Title, Journal, Year, 
         FirstAuthor = "First author country", 
         AuthorCategories = "Authorship groups")

# Objectives and Inference
review_Objectives <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                               sheet = "Objectives and Inference") |>
  select(ID = "Review ID", Status, Title, 
         Obj_Methods = "Methods?",
         Obj_Future = "Future predictions?",
         Obj_Spatial = "Spatial predictions?", 
         Obj_Hypothesis = "Hypothesis testing?")

# Species and Location
review_SpeciesLocation <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                                    sheet = "Species and Location") |>
  select(ID = "Review ID", Status, Title, 
         Taxa_Category = "Taxa keywords", Taxa_Number = "Number",
         IUCN_Status = "IUCN Status", Threat_Category = "Threat categories",
         Country, Continent, Realm, Size_km = "Study Size")

# Data Collection
review_DataCollection <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                                   sheet = "Data collection") |>
  select(ID = "Review ID", Status, Title,
         Duration = "Study duration", Detection_Method = "Capture method",
         Primary_Occasions = "Number of primary occasions",
         Secondary_Occasions = "Number of secondary occasions",
         Secondary_Type = "Type of secondary occasions",
         Site_Number = "Number of sites", Site_Type = "Type of site",
         Sampling_Method = "Sampling method")

# Covariates
review_Covariates <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                               sheet = "Covariates") |>
  select(ID = "Review ID", Status, Title, 
         Parameter, Covariate_Count = "Total covariates",
         Covariates = "Covariate List")

# Modelling
review_Modelling <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                              sheet = "Modelling") |>
  select(ID = "Review ID", Status, Title,
         Bayesian, Prefiltering = "Prefiltering category",
         Selection = "Selection category", Evaluation = "Evaluation method",
         Multispecies = "Multi-species", Connectivity)

```

# Study details

Basic metadata was collected for each paper in the review, with available data including:

+-------------------+--------------------------------------------------+--------------------------------------+
| Field             | Description                                      | Possible values                      |
+===================+==================================================+======================================+
| Journal           | Journal which this article was published in      | *Any*                                |
+-------------------+--------------------------------------------------+--------------------------------------+
| Year              | Year of publication                              | *Any*                                |
+-------------------+--------------------------------------------------+--------------------------------------+
| Author country    | Nation of the first author's primary affiliation | *ISO 3166 country names*             |
+-------------------+--------------------------------------------------+--------------------------------------+
| Author categories | Categories of affiliations for *all* authors     | *Academic, Government, NGO, Private* |
+-------------------+--------------------------------------------------+--------------------------------------+

```{r StudyDetails_Clean}
#| include: false

studyDetails_clean <- review_StudyDetails |>
  filter(Status == "Complete")  |>
  mutate(YearStrata = case_when(Year %in% 2000:2005 ~ "2000-2005",
                                Year %in% 2006:2010 ~ "2006-2010",
                                Year %in% 2011:2015 ~ "2011-2015",
                                Year %in% 2016:2020 ~ "2016-2020",
                                Year %in% 2021:2023 ~ "2021-2023"))
```

## Year coverage

```{r StudyDetails_years}
#| echo: false

studyDetails_clean |>
  filter(!is.na(YearStrata)) |>
  mutate(YearStrata = fct(YearStrata,
                          levels = c("2000-2005", "2006-2010",
                                     "2011-2015", "2016-2020",
                                     "2021-2023"))) |>
  summarise(Articles = n(), .by = YearStrata) |>
  
  ggplot() +
  geom_col(aes(x = YearStrata, y = Articles), fill = "darkslategrey") +
  labs(title = "Number of articles by year strata",
       x = "Year Strata", y = "Number of articles")
```

## Publication journals

```{r StudyDetails_journals}
#| echo: false

journalsTable <- studyDetails_clean |>
  summarise(Articles = n(), .by = "Journal") |>
  arrange(-Articles, Journal) 
```

`{r} nrow(journalsTable)` unique journals are represented in the sample - `{r} nrow(filter(journalsTable, Articles >1))` journals have more than one article.

```{r StudyDetails_journalsTable}
#| echo: false
reactable(journalsTable, defaultPageSize = 8)
```

## Authorship countries

```{r StudyDetails_countries}
#| echo: false

countriesTable <- studyDetails_clean |>
  summarise(Articles = n(), .by = "FirstAuthor") |>
  arrange(-Articles)
```

Counting by the location of the first author's institution, `{r} nrow(countriesTable)` countries are represented in the sample. A strong majority of articles were published by first authors based in the United States of America.

```{r StudyDetails_countriesTable}
#| echo: false

reactable(countriesTable, defaultPageSize = 8)
```

## Authorship categories

```{r StudyDetails_Categories}
#| echo: false
 
authorCategories_overall <- studyDetails_clean |>
  separate_rows(AuthorCategories, sep = ", ") |> 
  summarise(Articles = n(),
            Proportion = n()/nrow(studyDetails_clean),
            .by = AuthorCategories) |>
  mutate(Proportion = round(Proportion, 2)) |>
  rename(Category = AuthorCategories) |>
  arrange(-Proportion)
```

The most frequent category of authorship was academic, with `{r} max(authorCategories_overall$Proportion)` % of articles having at least one author from an academic institution.

```{r StudyDetails_CategoriesTable}
#| echo: false

kable(authorCategories_overall)
```

There is limited discernible change in authorship categories over time.

```{r StudyDetails_authorshipTrend}
#| echo: false
#| warning: false

studyDetails_clean |>
  filter(!is.na(YearStrata)) |>
  mutate(StrataArticles = n(), .by = YearStrata) |>
  separate_rows(AuthorCategories, sep = ", ") |> 
  summarise(Articles = n(),
            .by = c(AuthorCategories, YearStrata, StrataArticles)) |>
  mutate(Proportion = Articles/StrataArticles) |>
  mutate(YearStrata = fct(YearStrata,
                          levels = c("2000-2005", "2006-2010",
                                     "2011-2015", "2016-2020",
                                     "2021-2023")),
         AuthorCategories = fct(AuthorCategories,
                                levels = c("Academic", "Government",
                                           "NGO", "Private"))) |>
  complete(AuthorCategories, YearStrata) |>
  
  ggplot(aes(x = YearStrata, 
                 y = Proportion, 
                 fill = AuthorCategories)) +
  geom_col(position = "dodge") +
  labs(title = "Authorship trends over time",
       x = "Year of publication",
       y = "Proportion of Articles") +
  scale_fill_manual("Authorship category",
                    values = c("darkslategrey", "darkorchid3",
                               "cyan3", "goldenrod1"))
```

## 

# Objectives and inference

The stated objectives for each article were assessed and divided into four categories - each paper could fall into multiple (or zero) objective categories.

+---------------------+-----------------------------------------------------------------------------------+
| Objective           | Description                                                                       |
+=====================+===================================================================================+
| Methods             | Did authors seek to demonstrate or test specific methods for occupancy modelling? |
+---------------------+-----------------------------------------------------------------------------------+
| Future Predictions  | Did authors make predictions beyond the study period?                             |
+---------------------+-----------------------------------------------------------------------------------+
| Spatial Predictions | Did authors make predictions at locations where surveys were not conducted?       |
+---------------------+-----------------------------------------------------------------------------------+
| Hypothesis testing  | Did authors seek to test specific hypotheses of species occupancy dynamics?       |
+---------------------+-----------------------------------------------------------------------------------+

```{r Objectives_clean}
#| echo: false

objectives_Clean <- review_Objectives |>
  filter(Status == "Complete") |> 
  select(ID, Obj_Methods, Obj_Future, Obj_Spatial, Obj_Hypothesis) |>
  rowwise() |>
  mutate(Obj_None = case_when(all(c(Obj_Methods, Obj_Future,
                                    Obj_Spatial, Obj_Hypothesis) == "N") ~ "Y",
                              any(c(Obj_Methods, Obj_Future,
                                    Obj_Spatial, Obj_Hypothesis) == "Y") ~ "N")) |>
  pivot_longer(cols = c(Obj_Methods, Obj_Future, 
                        Obj_Spatial, Obj_Hypothesis, Obj_None), 
               names_to = "Objective", 
               values_to = "Stated") |>
  mutate(Objective = str_extract(Objective, "(?<=Obj\\_).+"),
         Stated = case_when(Stated == "Y" ~ TRUE,
                            Stated == "N" ~ FALSE)) |>
  left_join(select(studyDetails_clean, ID, 
                   Year, YearStrata), 
            by = "ID")
```

## Frequency of objectives

```{r Objectives_frequency}
#| echo: false

objectives_frequency <- objectives_Clean |>
  mutate(Total = length(unique(ID))) |>
  filter(Stated == TRUE) |>
  summarise(Articles = n(),
            .by = c(Objective, Total)) |>
  mutate(Proportion = Articles/Total) |> 
  arrange(-Proportion)
```

The most common objective was **Testing Hypotheses**, with `{r} max(objectives_frequency$Proportion)`% of articles examining pre-determined relationships. Prediction, whether spatial or temporal, was rare.

```{r Objectives_frequencyPlot}
#| echo: false

objectives_frequency |>
  mutate(Objective = fct(Objective,
                         levels = c("Hypothesis", "Methods",
                                    "Future", "Spatial",
                                    "None"))) |>
  
  ggplot() +
  geom_col(aes(x = Objective, y = Articles, fill = Objective)) +
  scale_fill_manual(values = c("darkorchid", "deepskyblue3",
                               "coral2", "goldenrod", "gray60")) +
  labs(title = "Number of articles by objective",
       subtitle = "'None' indicates that none of the objectives were stated,\ngenerally this indicates a focus on occupancy dynamics parameters",
       x = "Stated objective", y = "Number of articles") +
  theme(legend.position = "none")

```

## Stated objectives by authorship categories

Little variation was shown between the objectives of papers by different authorship categories.

```{r Objective_frequencyAuthorship}
#| echo: false

objectives_frequencyAuthorship <- objectives_Clean |>
  left_join(select(studyDetails_clean, ID, AuthorCategories), by = "ID") |>
  separate_rows(AuthorCategories, sep = ", ") |>
  filter(Stated == TRUE) |>
  mutate(Total = length(unique(ID)), .by = AuthorCategories) |>
  summarise(Articles = n(),
            .by = c(Objective, AuthorCategories, Total)) |>
  mutate(Proportion = Articles/Total) |>
  complete(Objective, AuthorCategories, 
           fill = list(Articles = 0,
                       Proportion = 0))

# Plot frequency faceted by authorship
objectives_frequencyAuthorship |>
  mutate(Objective = fct(Objective,
                         levels = c("Hypothesis", "Methods",
                                    "Future", "Spatial",
                                    "None"))) |>
  
  ggplot() +
  geom_col(aes(x = Objective, y = Proportion, fill = Objective)) +
  scale_fill_manual(values = c("darkorchid", "deepskyblue3",
                               "coral2", "goldenrod", "gray60")) +
  facet_wrap(facets = vars(AuthorCategories)) +
  labs(title = "Proportion of articles with each objective",
       subtitle = "'None' indicates that none of the listed objectives were stated,\ngenerally this indicates a focus on simply estimating occupancy dynamics",
       x = "Stated objective", y = "Number of articles") +
  theme(legend.position = "bottom")
```

## Stated objective by year

Objective categories have changed in frequency over time, with more variation in objectives in recent years relative to the early days of DOMs

```{r Objectives_byYear}
#| echo: false

objectives_Clean |>
  filter(!is.na(YearStrata)) |>
  filter(Stated == TRUE) |>
  mutate(Total = length(unique(ID)), .by = YearStrata) |>
  summarise(Articles = n(), .by = c(Objective, YearStrata, Total)) |>
  mutate(Proportion = Articles/Total) |>
  complete(Objective, YearStrata, fill = list(Articles = 0, Proportion = 0)) |>
  mutate(Objective = fct(Objective,
                         levels = c("Hypothesis", "Methods",
                                    "Future", "Spatial",
                                    "None"))) |>
  
  ggplot() +
  geom_col(aes(x = YearStrata, y = Proportion, fill = Objective),
           position = "dodge") +
  scale_fill_manual(values = c("darkorchid", "deepskyblue3",
                               "coral2", "goldenrod", "gray60")) +
  labs(title = "Objective categories over time",
       subtitle = "'None' indicates that none of the listed objectives were stated,\ngenerally this indicates a focus on simply estimating occupancy dynamics",
       y = "Proportion of articles", x = "Year Strata")

```

# Species and location

Data on focal species and the location of study areas was collected, available fields include:

+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Field           | Description                                                                                | Possible values                                                                   |
+=================+============================================================================================+===================================================================================+
| Taxa category   | Category of study taxa; could fit into multiple categories                                 | *Bird, Mammal, Invertebrate, Herptile, Fish, Threatened, Invasive, Other*         |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Taxa number     | Number of individual species within the taxa for which models were fit                     | *Numeric*                                                                         |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| IUCN status     | IUCN status for the study species; NA if multi-species or if the study species is invasive | *LC, NT, EN, CR, DD, NA*                                                          |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Threat category | Category of threats to the species; multiple per species permitted                         | *Habitat loss, Climate change, Exploitation, Invasives, Disease, Disaster, Other* |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Country         | Country/countries where the study took place                                               | *ISO 3166 country names*                                                          |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Continent       | Continent(s) where the study took place                                                    | *North America, South America, Europe, Asia, Africa, Oceania*                     |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Realm           | Biogeographic realm where the study took place                                             | *Nearctic, Palearctic, Afrotropical, Indomalayan, Australasian, Neotropical*      |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Size            | Size of the study area extent in square kilometres                                         | *\<1km, 1-10, 10-100, 100-1000, 10000-100000, 100000-1000000, 1000000+*           |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+

## Taxa categories

## Number of species

## Threatened taxa

## Study locations

# Data collection

+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Field               | Description                                                              | Possible values                                                                              |
+=====================+==========================================================================+==============================================================================================+
| Duration            | Length of study in months                                                | *Numeric*                                                                                    |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Capture method      | Method of recording detections; multiple categories possible             | *Audiovisual, Search, Trapping, Bioacoustic, Camera, Citizen, Incidental*                    |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Primary occasions   | Number of primary occasions                                              | *Numeric*                                                                                    |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Secondary occasions | Number of secondary occasions, presented as a range where not consistent | *Numeric range*                                                                              |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Secondary type      | Type of secondary occasion                                               | *Revisits, Spatial replicates, Same-visit replicates, multiple observers, time to detection* |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Type of site        | How a 'site' was defined                                                 | *Point location, Grid cell, Irregular area, Transect*                                        |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Number of sites     | Number of individual sites                                               | Numeric                                                                                      |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Sampling method     | How sites were selected                                                  | *Random, Stratified, Grid, Preferential, Available, Exhaustive, Uniform, Transect*           |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+

## Study duration

## Number of occasions

## Data collection method

## Sampling method

## Study size over time

# Covariates

All covariates considered for modelling were documented for each article. Details available for each covariate include:

+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field       | Description                                     | Possible values                                                                                                                                                     |
+=============+=================================================+=====================================================================================================================================================================+
| Parameter   | Parameter which this covariate was considered   | *Initial occupancy, colonisation, extinction, detection*                                                                                                            |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Type        | Category of covariate                           | *Environmental: Habitat type terrestrial, Habitat type aquatic, Anthropogenic, Topographic, Climate and weather, Disaster and disturbance, Hydrologic, Seasonality* |
|             |                                                 |                                                                                                                                                                     |
|             |                                                 | *Other: Interactions, Site geometry, Connectivity, Site-level effects, Species-level effects, Season-level effects, Survey details*                                 |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variation   | Level of variation for the covariate            | *Site, Season, Survey*                                                                                                                                              |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Measurement | How the covariate was recorded                  | *Remotely, Observed, Intrinsic*                                                                                                                                     |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Complexity  | How the covariate was mathmatically implemented | *Linear-only, Quadratics, Interactions, Interactions and Quadratics, Other*                                                                                         |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|             |                                                 |                                                                                                                                                                     |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+

## Covariate quantity

## Covariate categories

## Covariate features

## Frequency of covariate features

## Quantity of covariates by year

## Quantity of covariates by study size

# Modelling

Key details of the modelling process were documented.

+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Field         | Description                                               | Possible values                                                                                |
+===============+===========================================================+================================================================================================+
| Bayesian      | Whether the models fit were Bayesian                      | *Logical*                                                                                      |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Prefiltering  | Which, if any, prefiltering method was used               | *Expert, Simple, Other*                                                                        |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Selection     | Which, if any, selection method was used                  | *Single a priori, Multiple a priori, Exhaustive, Exhaustive by parameter, Forwards, Backwards* |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Evaluation    | How models were compared and evaluated                    | *AIC, AUC, DiC, Model-averaging, Bootstrapping*                                                |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Multi-species | Whether this was a multi-species model                    | *Logical*                                                                                      |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Connectivity  | Whether site connectivity was incorporated into the model | *Logical*                                                                                      |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
