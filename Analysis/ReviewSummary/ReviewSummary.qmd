---
title: "DOM Review Summary"
author: "Saoirse Kelleher"
date: today
abstract: "A summary of results from the DOM Review, for use in interpreting outputs and writing the review manuscript. "
abstract-title: "Summary"
format: 
  html:
    theme: minty
    toc: true
embed-resources: true
---

```{r Load_packages}
#| include: false

library(tidyverse)
library(readxl)
library(knitr)
library(reactable)
```

```{r Load_data}
#| include: false

# Study Details
review_StudyDetails <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                                 sheet = "Study") |>
  select(ID = "Review ID", Sample, Status, Title, Journal, Year, 
         FirstAuthor = "First author country", 
         AuthorCategories = "Authorship groups")

# Objectives and Inference
review_Objectives <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                               sheet = "Objectives and Inference") |>
  select(ID = "Review ID", Status, Title, 
         Obj_Methods = "Methods?",
         Obj_Future = "Future predictions?",
         Obj_Spatial = "Spatial predictions?", 
         Obj_Hypothesis = "Hypothesis testing?")

# Species and Location
review_SpeciesLocation <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                                    sheet = "Species and Location") |>
  select(ID = "Review ID", Status, Title, 
         Taxa_Category = "Taxa keywords", Taxa_Number = "Number",
         IUCN_Status = "IUCN Status", Threat_Category = "Threat categories",
         Country, Continent, Realm, Size_km = "Study Size")

# Data Collection
review_DataCollection <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                                   sheet = "Data collection") |>
  select(ID = "Review ID", Status, Title,
         Duration = "Study duration", Detection_Method = "Capture method",
         Primary_Occasions = "Number of primary occasions",
         Secondary_Occasions = "Number of secondary occasions",
         Secondary_Type = "Type of secondary occasions",
         Site_Number = "Number of sites", Site_Type = "Type of site",
         Sampling_Method = "Sampling method")

# Covariates
review_Covariates <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                               sheet = "Covariates") |>
  select(ID = "Review ID", Status, Title, 
         Parameter, Covariate_Count = "Total covariates",
         Covariates = "Covariate List")

# Modelling
review_Modelling <- read_xlsx("Spreadsheets/Stage3_Spreadsheet.xlsx",
                              sheet = "Modelling") |>
  select(ID = "Review ID", Status, Title,
         Bayesian, Prefiltering = "Prefiltering category",
         Selection = "Selection category", Evaluation = "Evaluation method",
         Multispecies = "Multi-species", Connectivity)

```

# Study details

Basic metadata was collected for each paper in the review, with available data including:

+-------------------+--------------------------------------------------+--------------------------------------+
| Field             | Description                                      | Possible values                      |
+===================+==================================================+======================================+
| Journal           | Journal which this article was published in      | *Any*                                |
+-------------------+--------------------------------------------------+--------------------------------------+
| Year              | Year of publication                              | *Any*                                |
+-------------------+--------------------------------------------------+--------------------------------------+
| Author country    | Nation of the first author's primary affiliation | *ISO 3166 country names*             |
+-------------------+--------------------------------------------------+--------------------------------------+
| Author categories | Categories of affiliations for *all* authors     | *Academic, Government, NGO, Private* |
+-------------------+--------------------------------------------------+--------------------------------------+

```{r StudyDetails_Clean}
#| include: false

studyDetails_clean <- review_StudyDetails |>
  filter(Status == "Complete")  |>
  mutate(YearStrata = case_when(Year %in% 2000:2005 ~ "2000-2005",
                                Year %in% 2006:2010 ~ "2006-2010",
                                Year %in% 2011:2015 ~ "2011-2015",
                                Year %in% 2016:2020 ~ "2016-2020",
                                Year %in% 2021:2023 ~ "2021-2023"))
```

## Year coverage

```{r StudyDetails_years}
#| echo: false

studyDetails_clean |>
  filter(!is.na(YearStrata)) |>
  mutate(YearStrata = fct(YearStrata,
                          levels = c("2000-2005", "2006-2010",
                                     "2011-2015", "2016-2020",
                                     "2021-2023"))) |>
  summarise(Articles = n(), .by = YearStrata) |>
  
  ggplot() +
  geom_col(aes(x = YearStrata, y = Articles), fill = "darkslategrey") +
  labs(title = "Number of articles by year strata",
       x = "Year Strata", y = "Number of articles")
```

## Publication journals

```{r StudyDetails_journals}
#| echo: false

journalsTable <- studyDetails_clean |>
  summarise(Articles = n(), .by = "Journal") |>
  arrange(-Articles, Journal) 
```

`{r} nrow(journalsTable)` unique journals are represented in the sample - `{r} nrow(filter(journalsTable, Articles >1))` journals have more than one article.

```{r StudyDetails_journalsTable}
#| echo: false
reactable(journalsTable, defaultPageSize = 8)
```

## Authorship countries

```{r StudyDetails_countries}
#| echo: false

countriesTable <- studyDetails_clean |>
  summarise(Articles = n(), .by = "FirstAuthor") |>
  arrange(-Articles)
```

Counting by the location of the first author's institution, `{r} nrow(countriesTable)` countries are represented in the sample. A strong majority of articles were published by first authors based in the United States of America.

```{r StudyDetails_countriesTable}
#| echo: false

reactable(countriesTable, defaultPageSize = 8)
```

## Authorship categories

```{r StudyDetails_Categories}
#| echo: false
 
authorCategories_overall <- studyDetails_clean |>
  separate_rows(AuthorCategories, sep = ", ") |> 
  summarise(Articles = n(),
            Proportion = n()/nrow(studyDetails_clean),
            .by = AuthorCategories) |>
  mutate(Proportion = round(Proportion, 2)) |>
  rename(Category = AuthorCategories) |>
  arrange(-Proportion)
```

The most frequent category of authorship was academic, with `{r} max(authorCategories_overall$Proportion)` % of articles having at least one author from an academic institution.

```{r StudyDetails_CategoriesTable}
#| echo: false

kable(authorCategories_overall)
```

There is limited discernible change in authorship categories over time.

```{r StudyDetails_authorshipTrend}
#| echo: false
#| warning: false

studyDetails_clean |>
  filter(!is.na(YearStrata)) |>
  mutate(StrataArticles = n(), .by = YearStrata) |>
  separate_rows(AuthorCategories, sep = ", ") |> 
  summarise(Articles = n(),
            .by = c(AuthorCategories, YearStrata, StrataArticles)) |>
  mutate(Proportion = Articles/StrataArticles) |>
  mutate(YearStrata = fct(YearStrata,
                          levels = c("2000-2005", "2006-2010",
                                     "2011-2015", "2016-2020",
                                     "2021-2023")),
         AuthorCategories = fct(AuthorCategories,
                                levels = c("Academic", "Government",
                                           "NGO", "Private"))) |>
  complete(AuthorCategories, YearStrata) |>
  
  ggplot(aes(x = YearStrata, 
                 y = Proportion, 
                 fill = AuthorCategories)) +
  geom_col(position = "dodge") +
  labs(title = "Authorship trends over time",
       x = "Year of publication",
       y = "Proportion of Articles") +
  scale_fill_manual("Authorship category",
                    values = c("darkslategrey", "darkorchid3",
                               "cyan3", "goldenrod1"))
```

## 

# Objectives and inference

The stated objectives for each article were assessed and divided into four categories - each paper could fall into multiple (or zero) objective categories.

+---------------------+-----------------------------------------------------------------------------------+
| Objective           | Description                                                                       |
+=====================+===================================================================================+
| Methods             | Did authors seek to demonstrate or test specific methods for occupancy modelling? |
+---------------------+-----------------------------------------------------------------------------------+
| Future Predictions  | Did authors make predictions beyond the study period?                             |
+---------------------+-----------------------------------------------------------------------------------+
| Spatial Predictions | Did authors make predictions at locations where surveys were not conducted?       |
+---------------------+-----------------------------------------------------------------------------------+
| Hypothesis testing  | Did authors seek to test specific hypotheses of species occupancy dynamics?       |
+---------------------+-----------------------------------------------------------------------------------+

```{r Objectives_clean}
#| echo: false

objectives_Clean <- review_Objectives |>
  filter(Status == "Complete") |> 
  select(ID, Obj_Methods, Obj_Future, Obj_Spatial, Obj_Hypothesis) |>
  rowwise() |>
  mutate(Obj_None = case_when(all(c(Obj_Methods, Obj_Future,
                                    Obj_Spatial, Obj_Hypothesis) == "N") ~ "Y",
                              any(c(Obj_Methods, Obj_Future,
                                    Obj_Spatial, Obj_Hypothesis) == "Y") ~ "N")) |>
  pivot_longer(cols = c(Obj_Methods, Obj_Future, 
                        Obj_Spatial, Obj_Hypothesis, Obj_None), 
               names_to = "Objective", 
               values_to = "Stated") |>
  mutate(Objective = str_extract(Objective, "(?<=Obj\\_).+"),
         Stated = case_when(Stated == "Y" ~ TRUE,
                            Stated == "N" ~ FALSE)) |>
  left_join(select(studyDetails_clean, ID, 
                   Year, YearStrata), 
            by = "ID")
```

## Frequency of objectives

```{r Objectives_frequency}
#| echo: false

objectives_frequency <- objectives_Clean |>
  mutate(Total = length(unique(ID))) |>
  filter(Stated == TRUE) |>
  summarise(Articles = n(),
            .by = c(Objective, Total)) |>
  mutate(Proportion = Articles/Total) |> 
  arrange(-Proportion)
```

The most common objective was **Testing Hypotheses**, with `{r} max(objectives_frequency$Proportion)`% of articles examining pre-determined relationships. Prediction, whether spatial or temporal, was rare.

```{r Objectives_frequencyPlot}
#| echo: false

objectives_frequency |>
  mutate(Objective = fct(Objective,
                         levels = c("Hypothesis", "Methods",
                                    "Future", "Spatial",
                                    "None"))) |>
  
  ggplot() +
  geom_col(aes(x = Objective, y = Articles, fill = Objective)) +
  scale_fill_manual(values = c("darkorchid", "deepskyblue3",
                               "coral2", "goldenrod", "gray60")) +
  labs(title = "Number of articles by objective",
       subtitle = "'None' indicates that none of the objectives were stated,\ngenerally this indicates a focus on occupancy dynamics parameters",
       x = "Stated objective", y = "Number of articles") +
  theme(legend.position = "none")

```

## Stated objectives by authorship categories

Little variation was shown between the objectives of papers by different authorship categories.

```{r Objective_frequencyAuthorship}
#| echo: false

objectives_frequencyAuthorship <- objectives_Clean |>
  left_join(select(studyDetails_clean, ID, AuthorCategories), by = "ID") |>
  separate_rows(AuthorCategories, sep = ", ") |>
  filter(Stated == TRUE) |>
  mutate(Total = length(unique(ID)), .by = AuthorCategories) |>
  summarise(Articles = n(),
            .by = c(Objective, AuthorCategories, Total)) |>
  mutate(Proportion = Articles/Total) |>
  complete(Objective, AuthorCategories, 
           fill = list(Articles = 0,
                       Proportion = 0))

# Plot frequency faceted by authorship
objectives_frequencyAuthorship |>
  mutate(Objective = fct(Objective,
                         levels = c("Hypothesis", "Methods",
                                    "Future", "Spatial",
                                    "None"))) |>
  
  ggplot() +
  geom_col(aes(x = Objective, y = Proportion, fill = Objective)) +
  scale_fill_manual(values = c("darkorchid", "deepskyblue3",
                               "coral2", "goldenrod", "gray60")) +
  facet_wrap(facets = vars(AuthorCategories)) +
  labs(title = "Proportion of articles with each objective",
       subtitle = "'None' indicates that none of the listed objectives were stated,\ngenerally this indicates a focus on simply estimating occupancy dynamics",
       x = "Stated objective", y = "Number of articles") +
  theme(legend.position = "bottom")
```

## Stated objective by year

Objective categories have changed in frequency over time, with more variation in objectives in recent years relative to the early days of DOMs

```{r Objectives_byYear}
#| echo: false

objectives_Clean |>
  filter(!is.na(YearStrata)) |>
  filter(Stated == TRUE) |>
  mutate(Total = length(unique(ID)), .by = YearStrata) |>
  summarise(Articles = n(), .by = c(Objective, YearStrata, Total)) |>
  mutate(Proportion = Articles/Total) |>
  complete(Objective, YearStrata, fill = list(Articles = 0, Proportion = 0)) |>
  mutate(Objective = fct(Objective,
                         levels = c("Hypothesis", "Methods",
                                    "Future", "Spatial",
                                    "None"))) |>
  
  ggplot() +
  geom_col(aes(x = YearStrata, y = Proportion, fill = Objective),
           position = "dodge") +
  scale_fill_manual(values = c("darkorchid", "deepskyblue3",
                               "coral2", "goldenrod", "gray60")) +
  labs(title = "Objective categories over time",
       subtitle = "'None' indicates that none of the listed objectives were stated,\ngenerally this indicates a focus on simply estimating occupancy dynamics",
       y = "Proportion of articles", x = "Year Strata")

```

# Species and location

```{r Species_clean}
species_clean <- review_SpeciesLocation |>
  filter(Status == "Complete") |>
  mutate(ID_clean = str_extract(ID, "[:digit:]+"))
```

Data on focal species and the location of study areas was collected, available fields include:

+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Field           | Description                                                                                | Possible values                                                                   |
+=================+============================================================================================+===================================================================================+
| Taxa category   | Category of study taxa; could fit into multiple categories                                 | *Bird, Mammal, Invertebrate, Herptile, Fish, Threatened, Invasive, Other*         |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Taxa number     | Number of individual species within the taxa for which models were fit                     | *Numeric*                                                                         |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| IUCN status     | IUCN status for the study species; NA if multi-species or if the study species is invasive | *LC, NT, EN, CR, DD, NA*                                                          |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Threat category | Category of threats to the species; multiple per species permitted                         | *Habitat loss, Climate change, Exploitation, Invasives, Disease, Disaster, Other* |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Country         | Country/countries where the study took place                                               | *ISO 3166 country names*                                                          |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Continent       | Continent(s) where the study took place                                                    | *North America, South America, Europe, Asia, Africa, Oceania*                     |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Realm           | Biogeographic realm where the study took place                                             | *Nearctic, Palearctic, Afrotropical, Indomalayan, Australasian, Neotropical*      |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| Size            | Size of the study area extent in square kilometres                                         | *\<1km, 1-10, 10-100, 100-1000, 10000-100000, 100000-1000000, 1000000+*           |
+-----------------+--------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+

## Taxa categories

```{r Species_Taxa}
#| echo: false

species_taxaTable <- species_clean |>
  separate_rows(Taxa_Category, sep = ", ") |>
  mutate(Total = length(unique(ID_clean))) |>
  select(Taxa_Category, ID_clean, Total) |>
  distinct() |>
  summarise(Articles = n(), 
            Percentage = round(Articles/mean(Total), 2)*100,
            .by = Taxa_Category) |>
  arrange(-Articles) |>
  rename(Taxa = Taxa_Category)
```

DOMs have been widely used for terrestrial taxa, with numerous examples modelling bird, mammal, and herptile occupancy dynamics. `{r} species_taxaTable$Articles[species_taxaTable$Taxa == "Threatened"]` articles described their focal species as threatened in some way; `{r} species_taxaTable$Articles[species_taxaTable$Taxa == "Invasive"]` fit models to invasive species.

```{r Species_TaxaTable}
#| echo: false

kable(species_taxaTable)
species_taxaTable |>
  mutate(Taxa = fct_reorder(Taxa, Articles)) |>
  
  ggplot() +
  geom_col(aes(x = Percentage, y = Taxa, fill = Taxa)) +
  scale_fill_manual(limits = c("Bird", "Threatened", "Mammal", 
                               "Herptile", "Invasive", "Invertebrate",
                               "Lichen"),
                    values = c("darkslategrey", "darkorange4", "darkslategrey", 
                               "darkslategrey", "darkorange4", "darkslategrey", 
                               "darkslategrey")) +
  theme(legend.position = "none") +
  xlim(c(0,50)) +
  labs(title = "Modelled taxa", 
       subtitle = "Multiple categories per article permitted",
       y = "", x = "Percentage of articles")

```

## Threats to modelled taxa

Of papers which describe any threats to their focal taxa, by far the most frequent threat was habitat loss.

```{r Species_Threats}
#| echo: false

species_clean |>
  filter(!Threat_Category %in% c("NA", "None"),
         !is.na(Threat_Category)) |> 
  separate_rows(Threat_Category, sep = ", ") |>
  select(ID_clean, Threat_Category) |>
  distinct() |>
  mutate(Total = length(unique(ID_clean))) |>
  summarise(Articles = n(), 
            Proportion = round(Articles/mean(Total), 2),
            .by = Threat_Category)|>
  mutate(Threat_Category = case_when(Threat_Category == "HabitatLoss" ~ "Habitat loss",
                                     Threat_Category == "ClimateChange" ~ "Climate change",
                                     Threat_Category == "Other_Pollution" ~ "Pollution",
                                     .default = Threat_Category)) |>
  mutate(Threat_Category = fct_reorder(Threat_Category, Articles)) |>
  
  ggplot() +
  geom_col(aes(x = Proportion, y = Threat_Category), fill = "darkslategrey") +
  xlim(c(0,1)) +
  labs(title = "Threats to study taxa",
       subtitle = "Of articles which explicitly mention any threats",
       x = "Proportion of articles", y = "")
```

## Threatened taxa

```{r Species_IUCN}
#| echo: false

species_clean |>
  summarise(Articles = n(), .by = IUCN_Status) |>
  filter(!IUCN_Status %in% c("Not applicable", "NA")) |>
  mutate(IUCN_Status = case_when(IUCN_Status == "NL" ~ "Not listed",
                                 .default = IUCN_Status)) |>
  mutate(IUCN_Status = fct(IUCN_Status,
                           levels = c("LC", "NT", "VU",
                                      "EN", "CR", "Not listed"))) |>
  
  ggplot() +
  geom_col(aes(x = IUCN_Status, y = Articles, fill = IUCN_Status)) +
  scale_fill_manual(values = c("darkslategrey", "darkorange3",
                               "darkorange3", "darkorange3",
                               "darkorange3", "darkslategrey")) +
  labs(title = "IUCN Red list status",
       subtitle = "Invasives, higher-order taxa, and grouped species excluded",
       y = "Number of articles", x = "IUCN Red List Status") +
  theme(legend.position = "none")
```

## Number of species

```{r Species_Number}
#| echo: false
species_Number <- species_clean |>
  select(ID_clean, Taxa_Number) |>
  mutate(Taxa_Number = sum(Taxa_Number), .by = ID_clean)
```

Only approximately half of articles modelled occupancy dynamics for a single taxa. Others fit multiple occupancy models: either multi-species models where 2+ taxa were modelled in concert, or many independent models fit for a suite of taxa. The largest number of species modelled in a single paper was **`{r} max(species_Number$Taxa_Number)`**.

```{r Species_NumberPlot}
#| echo: false

species_Number |>
  mutate(NumberGroup = case_when(Taxa_Number == 1 ~ "1",
                                 Taxa_Number %in% 2:10 ~ "2-10",
                                 Taxa_Number %in% 11:100 ~ "11-100",
                                 Taxa_Number > 100 ~ ">100")) |>
  summarise(Articles = n(), .by = NumberGroup) |>
  mutate(NumberGroup = fct(NumberGroup,
                           levels = c("1", "2-10", "11-100", ">100"))) |>
  
  ggplot() +
  geom_col(aes(x = NumberGroup, y = Articles), fill = "darkslategrey") +
  labs(title = "Number of species modelled per article",
       x = "Number of species", y = "Number of articles") 
```

## Study locations

Consistent with authorship trends, a majority of articles conducted studies in the United States.

::: panel-tabset
## Country

```{r Species_Country}
#| echo: false 

species_clean |> 
  select(ID_clean, Country) |>
  separate_rows(Country, sep = ", ") |> 
  distinct() |>
  summarise(Articles = n(), .by = Country) |>
  arrange(-Articles) |>
  reactable(defaultPageSize = 8)
```

## Continent

```{r Species_Continent}
#| echo: false 

species_clean |> 
  select(ID_clean, Continent) |>
  distinct() |>
  summarise(Articles = n(), .by = Continent) |>
  arrange(-Articles) |>
  reactable(defaultPageSize = 8)
```

## Realm

```{r Species_Realm}
#| echo: false 

species_clean |> 
  select(ID_clean, Realm) |>
  distinct() |>
  summarise(Articles = n(), .by = Realm) |>
  arrange(-Articles) |>
  reactable(defaultPageSize = 8)


```
:::

```{r Species_locations}

```

## Study area size

The size of the study area in square kilometres follows a log-normal distribution, with studies ranging from less than one to over one million square kilometres.

```{r Species_sizeKM}
#| echo: false

species_clean |> 
  select(ID_clean, Size_km) |>
  distinct() |>
  mutate(Size_km = case_when(Size_km == "<1" ~ "0-1",
                             Size_km == "1000-9999" ~ "1000-10000",
                             .default = Size_km)) |>
  summarise(Articles = n(), .by = Size_km) |>
  arrange(Size_km) |>
  mutate(Size_km = fct_inorder(Size_km)) |> 
  filter(!Size_km %in% c("Not specified", "Unspecified")) |>
  
  ggplot() +
  geom_col(aes(x = Size_km, y = Articles), fill = "darkslategrey") +
  labs(title = "Study area size",
       x = "Study area in square kilometres", 
       y = "Number of articles") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5))

```

# Data collection

+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Field               | Description                                                              | Possible values                                                                              |
+=====================+==========================================================================+==============================================================================================+
| Duration            | Length of study in months                                                | *Numeric*                                                                                    |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Capture method      | Method of recording detections; multiple categories possible             | *Audiovisual, Search, Trapping, Bioacoustic, Camera, Citizen, Incidental*                    |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Primary occasions   | Number of primary occasions                                              | *Numeric*                                                                                    |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Secondary occasions | Number of secondary occasions, presented as a range where not consistent | *Numeric range*                                                                              |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Secondary type      | Type of secondary occasion                                               | *Revisits, Spatial replicates, Same-visit replicates, multiple observers, time to detection* |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Type of site        | How a 'site' was defined                                                 | *Point location, Grid cell, Irregular area, Transect*                                        |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Number of sites     | Number of individual sites                                               | Numeric                                                                                      |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| Sampling method     | How sites were selected                                                  | *Random, Stratified, Grid, Preferential, Available, Exhaustive, Uniform, Transect*           |
+---------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+

```{r DataCollection_clean}
#| echo: false
#| warning: false

dataCollection_clean <- review_DataCollection |>
  filter(Status == "Complete") |>
  mutate(ID_clean = str_extract(ID, "[:digit:]+")) |>
  mutate(Duration = as.numeric(Duration)) |>
  separate_wider_delim(cols = Primary_Occasions, 
                       delim = "-",
                       names = c("Primary_Min", "Primary_Max"),
                       too_few = "align_start") |>
  separate_wider_delim(cols = Secondary_Occasions, 
                       delim = "-",
                       names = c("Secondary_Min", "Secondary_Max"),
                       too_few = "align_start") |>
  separate_wider_delim(cols = Site_Number, 
                       delim = "-",
                       names = c("SiteNumber_Min", "SiteNumber_Max"),
                       too_few = "align_start") |>
  mutate(Primary_Max = if_else(is.na(Primary_Max),
                               Primary_Min, Primary_Max),
         Secondary_Max = if_else(is.na(Secondary_Max),
                                 Secondary_Min, Secondary_Max),
         SiteNumber_Max = if_else(is.na(SiteNumber_Max),
                                  SiteNumber_Min, SiteNumber_Max)) |>
  mutate(across(c(Primary_Min, Primary_Max, 
                  Secondary_Min, Secondary_Max,
                  SiteNumber_Min, SiteNumber_Max),
                as.numeric))
```

## Study duration

Study duration, defined as the length of time between the first and last survey, ranged from **`{r} min(dataCollection_clean$Duration)`** month to **`{r} max(dataCollection_clean$Duration)/12`** years, with a median of **`{r} median(dataCollection_clean$Duration`** months.

```{r DataCollection_duration}
#| echo: false

dataCollection_clean |>
  ggplot() +
  geom_histogram(aes(x = Duration), 
                 binwidth = 0.1, fill = "darkslategrey") +
  scale_x_continuous(transform = "log10", 
                     breaks = c(1, 12, 60, 
                                120, 240, 480), 
                     labels = c("1 month", "1 year", "5 years", 
                                "10 years", "20 years", "40 years")) +
  labs(title = "Study duration distribution",
       subtitle = "Defined as time between first and last survey",
       y = "Frequency", x = "Study duration (log10 scale)")
```

## Number of occasions

The number of sampling occasions varied considerably. The number of primary occasions ranged from just **`{r} min(dataCollection_clean$Primary_Max)`** to **`{r} max(dataCollection_clean$Primary_Max)`** with a median of **`{r} median(dataCollection_clean$Primary_Max)`**.

The number of secondary occasions from **`{r} min(dataCollection_clean$Secondary_Max, na.rm = TRUE)`** to **`{r} max(dataCollection_clean$Secondary_Max, na.rm = TRUE)`** with a median of **`{r} median(dataCollection_clean$Secondary_Max, na.rm = TRUE)`**.

```{r DataCollection_PrimaryOccasions}
#| echo: false

dataCollection_clean |>
  rowwise() |>
  mutate(Primary_Max = case_when(Primary_Max > 30 ~ 30,
                                  .default = Primary_Max)) |>
  
  ggplot() +
  geom_histogram(aes(x = Primary_Max),
                 binwidth = 1, fill = "darkslategrey") +
  labs(title = "Number of primary occasions",
       x = "Number of primary occasions", y = "Number of articles") +
  scale_x_continuous(breaks = c(1, 5, 10, 20, 30),
                     labels = c("1", "5", "10", "20", "30+"))
```

```{r DataCollection_SecondaryOccasions}
#| echo: false

dataCollection_clean |>
  filter(!is.na(Secondary_Max)) |>
  rowwise() |>
  mutate(Secondary_Max = case_when(Secondary_Max > 20 ~ 20,
                                   .default = Secondary_Max)) |>
  
  ggplot() +
  geom_histogram(aes(x = Secondary_Max),
                 binwidth = 1, fill = "darkcyan") +
  labs(title = "Number of secondary occasions",
       subtitle = "Where variable, maximum number of occasions is presented",
       x = "Number of secondary occasions", y = "Number of articles") +
  scale_x_continuous(breaks = c(1, 5, 10, 20),
                     labels = c("1", "5", "10", "20+"))
```

```{r DataCollection_TotalOccasions}
#| echo: false

dataCollection_clean |>
  filter(!is.na(Secondary_Max) & !is.na(Primary_Max)) |>
  mutate(TotalOccasions = Secondary_Max*Primary_Max) |>
  ggplot() +
  geom_histogram(aes(x = TotalOccasions),
                 binwidth = 0.1,
                 fill = "darkorchid3") +
  labs(title = "Total number of occasions",
       subtitle = "Product of primary and secondary occasions",
       x = "Number of occasions (log10 scale)", y = "Number of articles") +
  scale_x_continuous(transform = "log10",
                     breaks = c(4, 10, 25, 50, 100, 500, 1000, 2000)) +
  scale_y_continuous(breaks = c(1, 3, 6, 9))
```

## Data collection method

The most common method for recording detections was human surveys, either structured (e.g. time-bound point counts or transects) or unstructured (searches of sites). Autonomous detection methods (camera traps & acoustic monitors) were used infrequently, despite their potential suitability.

```{r DataCollection_SamplingMethod}
#| echo: false 

dataCollection_clean |>
  mutate(Total = length(unique(ID_clean))) |>
  separate_rows(Detection_Method, sep = ", ") |>
  summarise(Articles = n(), 
            #Proportion = round(Articles/Total, 2),
            .by = c(Detection_Method, Total)) |>
  mutate(Percentage = round(Articles/Total, 2)*100) |>
  select(Detection_Method, Articles, Percentage) |>
  filter(!Detection_Method %in% c("66", NA, "Unspecificed",
                                  "Survey", "Incidental")) |>
  arrange(Percentage) |>
  mutate(Detection_Method = case_when(Detection_Method == "AudioVisual" ~ "Human structured survey",
                                      Detection_Method == "Search" ~ "Human unstructured search",
                                      Detection_Method == "Trapping" ~ "Physical trapping",
                                      Detection_Method == "Camera" ~ "Camera trapping",
                                      Detection_Method == "Citizen" ~ "Citizen science",
                                      Detection_Method == "Bioacoustic" ~ "Acoustic monitor")) |>
  mutate(Detection_Method = fct_inorder(Detection_Method)) |>
  
  ggplot() +
  geom_col(aes(x = Percentage, y = Detection_Method), fill = "darkslategrey") +
  labs(title = "Detection method",
       subtitle = "Multiple methods per article permitted",
       x = "Percentage of articles", y = "") +
  xlim(c(0,50))
```

## Number of sites

The number of sites where surveys were conducted ranged widely from **`{r} min(dataCollection_clean$SiteNumber_Max, na.rm = TRUE)`** to **`{r} max(dataCollection_clean$SiteNumber_Max, na.rm = TRUE)`**, with a median site count of **`{r} median(dataCollection_clean$SiteNumber_Max, na.rm = TRUE)`**.

```{r DataCollection_numberSites}
#| echo: false

dataCollection_clean |>
  filter(!is.na(SiteNumber_Max)) |>
  
  ggplot() +
  geom_histogram(aes(x = SiteNumber_Max), 
                 binwidth = 0.1, 
                 fill = "darkslategrey") +
  scale_x_continuous(transform = "log10",
                     breaks = c(5, 10, 25, 50, 100, 500, 1000, 10000)) +
  labs(title = "Number of sites",
       x = "Number of sites", y = "Number of articles")
```

## Sampling method

```{r DataCollection_Sampling}



```

## Study size over time

# Covariates

All covariates considered for modelling were documented for each article. Details available for each covariate include:

+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field       | Description                                     | Possible values                                                                                                                                                     |
+=============+=================================================+=====================================================================================================================================================================+
| Parameter   | Parameter which this covariate was considered   | *Initial occupancy, colonisation, extinction, detection*                                                                                                            |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Type        | Category of covariate                           | *Environmental: Habitat type terrestrial, Habitat type aquatic, Anthropogenic, Topographic, Climate and weather, Disaster and disturbance, Hydrologic, Seasonality* |
|             |                                                 |                                                                                                                                                                     |
|             |                                                 | *Other: Interactions, Site geometry, Connectivity, Site-level effects, Species-level effects, Season-level effects, Survey details*                                 |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variation   | Level of variation for the covariate            | *Site, Season, Survey*                                                                                                                                              |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Measurement | How the covariate was recorded                  | *Remotely, Observed, Intrinsic*                                                                                                                                     |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Complexity  | How the covariate was mathmatically implemented | *Linear-only, Quadratics, Interactions, Interactions and Quadratics, Other*                                                                                         |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|             |                                                 |                                                                                                                                                                     |
+-------------+-------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+

## Covariate quantity

## Covariate categories

## Covariate features

## Frequency of covariate features

## Quantity of covariates by year

## Quantity of covariates by study size

# Modelling

Key details of the modelling process were documented.

+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Field         | Description                                               | Possible values                                                                                |
+===============+===========================================================+================================================================================================+
| Bayesian      | Whether the models fit were Bayesian                      | *Logical*                                                                                      |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Prefiltering  | Which, if any, prefiltering method was used               | *Expert, Simple, Other*                                                                        |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Selection     | Which, if any, selection method was used                  | *Single a priori, Multiple a priori, Exhaustive, Exhaustive by parameter, Forwards, Backwards* |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Evaluation    | How models were compared and evaluated                    | *AIC, AUC, DiC, Model-averaging, Bootstrapping*                                                |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Multi-species | Whether this was a multi-species model                    | *Logical*                                                                                      |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
| Connectivity  | Whether site connectivity was incorporated into the model | *Logical*                                                                                      |
+---------------+-----------------------------------------------------------+------------------------------------------------------------------------------------------------+
