---
title: "UoM Library literature scraping"
output: html_notebook
---

This notebook contains simple HTML scraping code for the University of Melbourne Library's result pages. Search results are read page by page with 'rvest', and information including titles, sources, and abstracts of journal articles is parsed via regex. In this case, a set of alternative search terms for Occupancy Dynamics Models are used and the resulting papers for each search are compared.

```{r, Setup, echo = FALSE, warning = FALSE}
library(tidyverse)
library(knitr)
library(rvest)

opts_knit$set(root.dir = "/Users/jkelleher/Documents/Research/QAEco/ODM_Review/R Code/")
```



For each query, links for each page of results are manually collected. The individual query lists are collated to be processed together.
```{r, HTML list}
# 'Occupancy dynamics model'
odmHtml <- data.frame(Page = 1,
                   Link = c("https://eds.s.ebscohost.com/eds/resultsadvanced?vid=5&sid=922f39a3-20c7-454a-a22c-4db93be87a9e%40redis&bquery=%22Occupancy+dynamic+model%22+OR+%22Occupancy+dynamics+model%22&bdata=JkF1dGhUeXBlPXNzbyZjbGkwPUZUJmNsdjA9WSZjbGkxPURUMSZjbHYxPTIwMDAwMS0yMDIyMTImdHlwZT0xJnNlYXJjaE1vZGU9QW5kJnNpdGU9ZWRzLWxpdmUmc2NvcGU9c2l0ZQ%3d%3d"),
                   Query = 'Occupancy dynamic model')
# 'Dynamic occupancy model' OR 'Dynamics occupancy model'
domHtml <- data.frame(Page = 1:2,
                   Link = c("https://eds.s.ebscohost.com/eds/resultsadvanced?vid=6&sid=922f39a3-20c7-454a-a22c-4db93be87a9e%40redis&bquery=%22Dynamic+occupancy+model%22+OR+%22Dynamics+occupancy+model%22&bdata=JkF1dGhUeXBlPXNzbyZjbGkwPUZUJmNsdjA9WSZjbGkxPURUMSZjbHYxPTIwMDAwMS0yMDIyMTImdHlwZT0xJnNlYXJjaE1vZGU9QW5kJnNpdGU9ZWRzLWxpdmUmc2NvcGU9c2l0ZQ%3d%3d",
                            "https://eds.s.ebscohost.com/eds/resultsadvanced?vid=6&sid=922f39a3-20c7-454a-a22c-4db93be87a9e%40redis&bquery=%22Dynamic+occupancy+model%22+OR+%22Dynamics+occupancy+model%22&bdata=JkF1dGhUeXBlPXNzbyZjbGkwPUZUJmNsdjA9WSZjbGkxPURUMSZjbHYxPTIwMDAwMS0yMDIyMTImdHlwZT0xJnNlYXJjaE1vZGU9QW5kJnNpdGU9ZWRzLWxpdmUmc2NvcGU9c2l0ZQ%3d%3d"),
                   Query = 'Dynamic occupancy model')
# 'Stochastic patch occupancy model'
spomHtml <- data.frame(Page = 1,
                   Link = c("https://eds.s.ebscohost.com/eds/resultsadvanced?vid=11&sid=922f39a3-20c7-454a-a22c-4db93be87a9e%40redis&bquery=%22Stochastic+patch+occupancy+model%22&bdata=JkF1dGhUeXBlPXNzbyZjbGkwPUZUJmNsdjA9WSZjbGkxPURUMSZjbHYxPTIwMDAwMS0yMDIyMTImdHlwZT0xJnNlYXJjaE1vZGU9QW5kJnNpdGU9ZWRzLWxpdmUmc2NvcGU9c2l0ZQ%3d%3d"),
                   Query = 'Stochastic patch occupancy model')
# 'Multi season occupancy model' OR 'Multi-season occupancy model' OR 'Multiseason occupancy model'
msoHtml <- data.frame(Page = 1,
                   Link = c(),
                   Query = 'Multi season occupancy model')
# 'Metapopulation model' OR 'Meta-population model' OR 'Meta population model
#metapopulationHtml <- data.frame(Page = 1:5,
#                   Link = c(),
#                   Query = 'Metapopulation model')
# 'Incidence-function model' OR 'Incidence function model'
ifmHtml <- data.frame(Page = 1:3,
                   Link = c(),
                   Query = 'Incidence function model')
# 'Hanski model'
hanskiHtml <- data.frame(Page = 1,
                   Link = c(),
                   Query = 'Hanski model')
# 'Colonization-extinction model' OR 'Colonisation-extinction model' OR 'Colonization extinction model OR 'Colonisation extinction model
cemHtml <- data.frame(Page = 1,
                   Link = c(),
                   Query = 'Colonisation extinction model')


queriesHtml <- rbind(odmHtml, domHtml, spomHtml, msoHtml,
                     #metapopulationHtml,
                     ifmHtml, hanskiHtml, cemHtml)


```



```{r, Scrape results}
outText <- data.frame()
for (i in 1:nrow(queriesHtml)){
  results <- read_html(queriesHtml$Link[i]) %>%
    html_elements("div.result-list-record") %>%
    html_text2() %>%
    as.data.frame() %>%
    mutate(Query = queriesHtml$Query[i])
  outText <- rbind(outText, results)
}
```



```{r, Parse text}
paperDf <- outText %>%
  rename('htmlText' = '.') %>%
  mutate(Title = str_extract(htmlText, "[^\\n]+"),
         Abstract = str_extract(htmlText, "Abstract:(.+)")) 
```